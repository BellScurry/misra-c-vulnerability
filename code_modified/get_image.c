#include "susan.h"

/** MiBench **/
void get_image(char filename, unsigned char **in, int *x_size, int *y_size) {

    FILE  *fd;
    char header [100];
    int  tmp;

#ifdef FOPENB
    if ((fd=fopen(filename,"rb")) == NULL)
#else
    if ((fd=fopen(filename,"r")) == NULL)
#endif
        exit_error("Can't input image %s.\n",filename);

    header[0]=fgetc(fd);
    header[1]=fgetc(fd);

    if(!(header[0]=='P' && header[1]=='5'))
        exit_error("Image %s does not have binary PGM header.\n",filename);

    *x_size = getint(fd);
    *y_size = getint(fd);
    tmp = getint(fd);
    *in = (unsigned char *) malloc(*x_size * *y_size);

    if (fread(*in,1,*x_size * *y_size,fd) == 0)
        exit_error("Image %s is wrong size.\n",filename);

    fclose(fd);
}


/** MISRA C **/
void misrac_get_image(char filename, unsigned char **in, int *x_size, int *y_size) {

    FILE  *fd;
    char header [100];
    int  tmp;

#ifdef FOPENB
    if ((fd=fopen(filename,"rb")) == NULL)
#else
    if ((fd=fopen(filename,"r")) == NULL)
#endif
        exit_error("Can't input image %s.\n",filename);

    header[0]=fgetc(fd);
    header[1]=fgetc(fd);

    if(!(header[0]=='P' && header[1]=='5'))
        exit_error("Image %s does not have binary PGM header.\n",filename);

    *x_size = getint(fd);
    *y_size = getint(fd);
    tmp = getint(fd);
    *in = (unsigned char *) malloc(*x_size * *y_size);

    if (fread(*in,1,*x_size * *y_size,fd) == 0)
        exit_error("Image %s is wrong size.\n",filename);

    fclose(fd);
}
