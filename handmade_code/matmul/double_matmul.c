#include <stdio.h>
#include <stdlib.h>


int main (int argc, char *argv[]) {

    FILE *in_file;

#ifndef __MISRA_C__
    double **a, **b, **c;
#elif defined(__ROW_SIZE_1__) && \
      defined(__COL_SIZE_1__) && \
      defined(__ROW_SIZE_2__) && \
      defined(__COL_SIZE_2__)
    double a[__ROW_SIZE_1__][__COL_SIZE_1__];
    double b[__ROW_SIZE_2__][__COL_SIZE_2__];
    double c[__ROW_SIZE_1__][__COL_SIZE_2__];
#endif

    int row, col, j;
    int row_size1, col_size1, row_size2, col_size2;

    //  Argument Processing
    if (argc < 2) {
    
        fprintf(stderr, "Too less arguments\n");
        exit(EXIT_FAILURE);
    }

    in_file = fopen(argv[1], "r");

    fscanf(in_file, "%d %d %d %d", &row_size1, &col_size1, &row_size2, &col_size2);

#ifdef __MISRA_C__
    //  If (size) > (static alloc size), exit
    if (__ROW_SIZE_1__ < row_size1 || \
        __COL_SIZE_1__ < col_size1 || \
        __ROW_SIZE_2__ < row_size2 || \
        __COL_SIZE_2__ < col_size2) {
    
        fprintf(stderr, "ERROR: Static allocation size doesn't fit\n");
        exit(EXIT_FAILURE);
    }
#else
    //  Allocation
    a = (double **)malloc(sizeof(double *) * row_size1);

    for (row=0; row < row_size1; row++)
        a[row] = (double *)malloc(sizeof(double) * col_size1);

    b = (double **)malloc(sizeof(double *) * row_size2);

    for (row=0; row < row_size2; row++)
        b[row] = (double *)malloc(sizeof(double) * col_size2);

    c = (double **)malloc(sizeof(double *) * row_size1);

    for (row=0; row < row_size1; row++)
        c[row] = (double *)malloc(sizeof(double) * col_size2);
#endif

    //  Fill Matrice
    for (row=0; row < row_size1; row++)
        for (col=0; col < col_size1; col++)
            fscanf(in_file, "%lf", &a[row][col]);

    for (row=0; row < row_size2; row++)
        for (col=0; col < col_size2; col++)
            fscanf(in_file, "%lf", &b[row][col]);

    //  Matrix Multiplication
    for (row=0; row < row_size1; row++) {
    
        for (col=0; col < col_size2; col++) {
        
            c[row][col] = 0;

            for (j=0; j<col_size1; j++)
                c[row][col] += a[row][j] * b[j][col];
        }
    }

    //  Print Output
    for (row=0; row < row_size1; row++) {
    
        for (col=0; col < col_size2; col++)
            printf("%lf ", c[row][col]);
        
        printf("\n");
    }
    fclose(in_file);

    return 0;
}
