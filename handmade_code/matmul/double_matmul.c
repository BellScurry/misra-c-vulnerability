#include <stdio.h>
#include <stdlib.h>


int main (int argc, char *argv[]) {

    #define BASE_ROW_SIZE1                  100
    #define BASE_COLUMN_SIZE1               100
    #define BASE_ROW_SIZE2    BASE_COLUMN_SIZE1
    #define BASE_COLUMN_SIZE2               100

#ifndef __MISRA_C__
    double **a, **b, **c;
#else
    double a[BASE_ROW_SIZE1][BASE_COLUMN_SIZE1];
    double b[BASE_ROW_SIZE2][BASE_COLUMN_SIZE2];
    double c[BASE_ROW_SIZE1][BASE_COLUMN_SIZE2];
#endif

    int i, j, k, index;
    int row_size1, column_size1, row_size2, column_size2;

    //  Argument Processing
    if (argc < 5) {
    
        fprintf(stderr, "Too less arguments\n");
        exit(1);
    }

    row_size1 = atoi(argv[1]), column_size1 = atoi(argv[2]);
    row_size2 = atoi(argv[3]), column_size2 = atoi(argv[4]);

    if (argc != 5 + row_size1 * column_size1 + row_size2 * column_size2) {
    
        fprintf(stderr, "Wrong number of arguments\n");
        exit(1);
    }

    //  Allocation
#ifndef __MISRA_C__
    a = (double **)malloc(sizeof(double *) * row_size1);

    for (i=0; i<row_size1; i++)
        a[i] = (double *)malloc(sizeof(double) * column_size1);

    b = (double **)malloc(sizeof(double *) * row_size2);

    for (j=0; j<row_size2; j++)
        b[j] = (double *)malloc(sizeof(double) * column_size2);

    c = (double **)malloc(sizeof(double *) * row_size1);

    for (i=0; i<row_size1; i++)
        c[i] = (double *)malloc(sizeof(double) * column_size2);
#endif

    //  Fill Matrice
    index = 5;

    for (i=0; i<row_size1; i++)
        for (j=0; j<column_size1; j++, index++)
            a[i][j] = atof(argv[index]);

    for (j=0; j<row_size2; j++)
        for (k=0; k<column_size2; k++, index++)
            b[j][k] = atof(argv[index]);

    //  Matrix Multiplication
    for (i=0; i<row_size1; i++) {
    
        for (k=0; k<column_size2; k++) {
        
            c[i][k] = 0;

            for (j=0; j<column_size1; j++)
                c[i][k] += a[i][j] * b[j][k];
        }
    }

    //  
    for (i=0; i<row_size1; i++) {
    
        for (k=0; k<column_size2; k++)
            printf("%lf ", c[i][k]);
        
        printf("\n");
    }

    return 0;
}
