# Usage
#   $1: 'gemV' Home
#   $2: Benchmark Path
#   $3: Benchmark Input Path
#
# Absolute Path Info
GEMV_HOME="/home/yonsei_dclab/yohan/GemV-2.0/gemV"
BENCHMARK_HOME="/home/yonsei_dclab/misra-c-vulnerability/code_modified"

# Rel Path Info
config_file="$GEMV_HOME/configs/example/se.py" #Pathtoconfigfile

# Config List
#arch_list=("ARM" "X86")
arch_list=("ARM")
misrac_tf=("" "_misrac")
susan_option=("" "-e" "-c")
susan_option_desc=("smoothing" "edge" "corner")

# Benchmark Input
input_file_name="input_large"
input_file_extension=".pgm"

# gemV Configurations
protection=no_protection #Protectionschemetobeused
vul_analysis=yes #Enable/Disablevulnerabilityanalysis
cpu_type=arm_detailed #CPUType
num_procs=1 #Numberofprocessors
num_l2=1 #NumberofL2caches
l1d_size=8kB #SizeofL1Datacache
l1i_size=4kB #SizeofL1Instructioncache
l2_size=32kB #SizeofL2cacche
l1d_assoc=2 #L1Datacacheassociativity
l1i_assoc=2 #L1Instructioncacheassociativity
l2_assoc=4 #L2associativity
cacheline_size=64 #Sizeofcacheline

for arch in "${arch_list[@]}";
do
    gemv_binary="$GEMV_HOME/build/$arch/gem5.opt"

    for misrac in "${misrac_tf[@]}";
    do
        benchmark="$BENCHMARK_HOME/susan${misrac}_$arch"

        for (( i=0 ; i < 3 ; i++));
        do
        output_dir="$GEMV_HOME/output/susan${misrac}_${susan_option_desc[$i]}_${arch}/benchinput_${input_file_name}"
        benchmark_input="$BENCHMARK_HOME/$input_file_name$input_file_extension${susan_option[$i]}"
        $gemv_binary -re -d $output_dir $config_file --cpu-type=$cpu_type --caches --l2cache -n $num_procs --num-l2caches=$num_l2 --l1d_size=$l1d_size --l1i_size=$l1i_size --l2_size=$l2_size --l1d_assoc=$l1d_assoc --l1i_assoc=$l1i_assoc --l2_assoc=$l2_assoc --cacheline_size=$cacheline_size --vul_analysis=$vul_analysis --cache_prot=$protection -c ${benchmark} -o ${benchmark_input} --vul_params="$GEMV_HOME/params.in"
        done
    done
done
