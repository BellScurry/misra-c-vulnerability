# Usage
#    $1: gemV Home
#    $2: where we want to place digest
#
# Absolute Path Info
if [ "$#" -gt 0 ];then
    GEMV_HOME=$1
else
    GEMV_HOME=/home/yonsei_dclab/yohan/GemV-2.0/gemV
fi

if [ "$#" -gt 1 ];then
    destination=$2
else
    destination=..
fi

# Relative Path Info
output_dir="$GEMV_HOME/output"

for file1 in $output_dir/*
do
    benchmark=$(echo ${file1} | sed -s 's/^\(.*\/\)*\(.*\)_.*/\2/')
    arch=$(echo ${file1} | sed -s 's/^\(.*\/\)*.*_\(.*\)/\2/')
    
    for file2 in $file1/*
    do
        benchmark_input=$(echo ${file2} | sed -s 's/^\(.*\/\)*benchinput_\(.*\)/\2/')

        for statfile in $file2/*
        do
            statfile_name=$(echo ${statfile} | sed -s 's/^\(.*\/\)*\(.*\)/\2/')

            if [[ "$statfile_name" == "stats.txt" ]]; then

                output_path="$destination/digest/${arch}/${benchmark}/${benchmark_input}"
                mkdir -p $output_path
                output_file="$output_path/${arch}_${benchmark}_${benchmark_input}__digest.txt"

                # Find keyword 'vulnerability', 'sim_ticks', and 'sim_insts'.
                # Then, print whole line.
                sed -n '/^.*\(vulnerability\|sim_ticks\|sim_insts\).*$/p' $statfile > $output_file
            fi
        done
    done
done
