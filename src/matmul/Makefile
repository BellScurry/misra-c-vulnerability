source = matmul.c
CC = arm-linux-gnueabi-gcc
CFLAGS = -static -O0

all: 
	$(CC) $(CFLAGS) $(source) -o matmul_20x20_20x20_normal
	$(CC) $(CFLAGS) $(source) -o matmul_20x20_20x20_misrac -D_MISRAC -D_ROW_SIZE1=20 -D_COL_SIZE1=20 -D_ROW_SIZE2=20 -D_COL_SIZE2=20
	arm-linux-gnueabi-objdump -d           matmul_20x20_20x20_normal > matmul_20x20_20x20_normal.s
	arm-linux-gnueabi-objdump -d           matmul_20x20_20x20_misrac > matmul_20x20_20x20_misrac.s
	python3 ../../script/parse_binary.py matmul_20x20_20x20_normal.s matmul_20x20_20x20_normal.main.txt
	python3 ../../script/parse_binary.py matmul_20x20_20x20_misrac.s matmul_20x20_20x20_misrac.main.txt
	-diff -sq matmul_20x20_20x20_normal.main.txt matmul_20x20_20x20_misrac.main.txt

clean:
	rm *_normal *_misrac *.s *.txt
