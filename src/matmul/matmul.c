#include <stdio.h>
#include <stdlib.h>

#ifndef _ALLOC_SIZE
#error "You must define _ALLOC_SIZE"
#endif

int main (int argc, char *argv[]) {

    FILE *in_file;

#ifndef _MISRAC
    double *a, *b, *c;
#else
    double a[_ALLOC_SIZE];
    double b[_ALLOC_SIZE];
    double c[_ALLOC_SIZE];
#endif

    int row, col, j, index;
    int row_size1, col_size1, row_size2, col_size2;

    //  Argument Processing
    if (argc < 2) {
    
        fprintf(stderr, "Too less arguments\n");
        exit(EXIT_FAILURE);
    }

    in_file = fopen(argv[1], "r");
    fscanf(in_file, "%d %d %d %d", &row_size1, &col_size1, &row_size2, &col_size2);

#ifndef _MISRAC
    //  Allocation
    a = (double *)malloc(sizeof(double) * _ALLOC_SIZE);
    b = (double *)malloc(sizeof(double) * _ALLOC_SIZE);
    c = (double *)malloc(sizeof(double) * _ALLOC_SIZE);
#endif

    //  Fill Matrice
    for(index=0, row=0; row < row_size1; row++)
        for(col=0; col < col_size1; index++, col++)
            fscanf(in_file, "%lf", &a[index]);

    for(index=0, row=0; row < row_size2; row++)
        for(col=0; col < col_size2; index++, col++)
            fscanf(in_file, "%lf", &b[index]);
    
    fclose(in_file);

    //  Matrix Multiplication
    for(index=0, row=0; row < row_size1; row++) {
        for(col=0; col < col_size2; index++, col++) {
            c[index] = 0;

            for (j=0; j<col_size1; j++)
                c[index] += a[row*col_size1 + j] * b[j*row_size2 + col];
        }
    }

    //  Print Output
    for(index=0, row=0; row < row_size1; row++) {
        for(col=0; col < col_size2; index++, col++)
            printf("%lf ", c[index]);
        
        printf("\n");
    }
#ifndef _MISRAC
    free(a);
    free(b);
    free(c);
#endif
    return 0;
}
