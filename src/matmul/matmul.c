#include <stdio.h>
#include <stdlib.h>

#ifdef _MISRAC
#  ifndef _ROW_SIZE1
#  error "You must define _ROW_SIZE1"
#  endif
#  ifndef _COL_SIZE1
#  error "You must define _COL_SIZE1"
#  endif
#  ifndef _ROW_SIZE2
#  error "You must define _ROW_SIZE2"
#  endif
#  ifndef _COL_SIZE2
#  error "You must define _COL_SIZE2"
#  endif
#endif
int main (int argc, char *argv[]) {

    FILE *in_file;

#ifndef _MISRAC
    double **a, **b, **c;
#else
    double a[_ROW_SIZE1][_COL_SIZE1];
    double b[_ROW_SIZE2][_COL_SIZE2];
    double c[_ROW_SIZE1][_COL_SIZE2];
#endif

    int row, col, j;
    int row_size1, col_size1, row_size2, col_size2;

    //  Argument Processing
    if (argc < 2) {
    
        fprintf(stderr, "Too less arguments\n");
        exit(EXIT_FAILURE);
    }

    in_file = fopen(argv[1], "r");
    fscanf(in_file, "%d %d %d %d", &row_size1, &col_size1, &row_size2, &col_size2);

#ifndef _MISRAC
    //  Allocation
    a = (double **)malloc(sizeof(double*) * row_size1);
    for(row=0; row < row_size1; row++)
        a[row] = (double *)malloc(sizeof(double) * col_size1);

    b = (double **)malloc(sizeof(double*) * row_size2);
    for(row=0; row < row_size2; row++)
        b[row] = (double *)malloc(sizeof(double) * col_size2);
    
    c = (double **)malloc(sizeof(double*) * row_size1);
    for(row=0; row < row_size1; row++)
        c[row] = (double *)malloc(sizeof(double) * col_size2);
#endif

    //  Fill Matrice
    for(row=0; row < row_size1; row++)
        for(col=0; col < col_size1; col++)
            fscanf(in_file, "%lf", &a[row][col]);

    for(row=0; row < row_size2; row++)
        for(col=0; col < col_size2; col++)
            fscanf(in_file, "%lf", &b[row][col]);
    
    fclose(in_file);

    //  Matrix Multiplication
    for(row=0; row < row_size1; row++) {
        for(col=0; col < col_size2; col++) {
            c[row][col] = 0;
            for(j=0; j < col_size1; j++)
                c[row][col] += a[row][j] * b[j][col];
        }
    }

    //  Print Output
    for(row=0; row < row_size1; row++) {
        for(col=0; col < col_size2; col++)
            printf("%lf ", c[row][col]);
        printf("\n");
    }
#ifndef _MISRAC
    free(a);
    free(b);
    free(c);
#endif
    return 0;
}
