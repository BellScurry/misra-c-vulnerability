executable = matmul_fixed_1000_normal_arm  matmul_fixed_1000_misrac_arm
source = matmul_fixed.c
CC = arm-linux-gnueabi-gcc
CFLAGS = -static -O0

all: 
	$(CC) $(CFLAGS) $(source)           -D_ALLOC_SIZE=1000      -o matmul_fixed_1000_normal_arm
	$(CC) $(CFLAGS) $(source) -D_MISRAC -D_ALLOC_SIZE=1000      -o matmul_fixed_1000_misrac_arm
	arm-linux-gnueabi-objdump -d           matmul_fixed_1000_normal_arm > matmul_fixed_1000_normal_arm.s
	arm-linux-gnueabi-objdump -d           matmul_fixed_1000_misrac_arm > matmul_fixed_1000_misrac_arm.s
	python3 ../../script/parse_binary.py matmul_fixed_1000_normal_arm.s matmul_fixed_1000_normal_arm.main.s.txt
	python3 ../../script/parse_binary.py matmul_fixed_1000_misrac_arm.s matmul_fixed_1000_misrac_arm.main.s.txt
	-diff -sq matmul_fixed_1000_normal_arm.main.s.txt matmul_fixed_1000_misrac_arm.main.s.txt

clean:
	rm $(executable) *.s *.txt
